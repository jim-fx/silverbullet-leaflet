var b=Object.defineProperty;var f=(e,t)=>{for(var o in t)b(e,o,{get:t[o],enumerable:!0})};var u=e=>{throw new Error("Not initialized yet")},p=typeof window>"u"&&typeof globalThis.WebSocketPair>"u";typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var m=new Map,d=0;p&&(globalThis.syscall=async(e,...t)=>await new Promise((o,r)=>{d++,m.set(d,{resolve:o,reject:r}),u({type:"sys",id:d,name:e,args:t})}));function g(e,t,o){p&&(u=o,self.addEventListener("message",r=>{(async()=>{let i=r.data;switch(i.type){case"inv":{let a=e[i.name];if(!a)throw new Error(`Function not loaded: ${i.name}`);try{let s=await Promise.resolve(a(...i.args||[]));u({type:"invr",id:i.id,result:s})}catch(s){console.error("An exception was thrown as a result of invoking function",i.name,"error:",s.message),u({type:"invr",id:i.id,error:s.message})}}break;case"sysr":{let a=i.id,s=m.get(a);if(!s)throw Error("Invalid request id");m.delete(a),i.error?s.reject(new Error(i.error)):s.resolve(i.result)}break}})().catch(console.error)}),u({type:"manifest",manifest:t}))}function w(e){let t=atob(e),o=t.length,r=new Uint8Array(o);for(let i=0;i<o;i++)r[i]=t.charCodeAt(i);return r}function y(e){typeof e=="string"&&(e=new TextEncoder().encode(e));let t="",o=e.byteLength;for(let r=0;r<o;r++)t+=String.fromCharCode(e[r]);return btoa(t)}async function C(e,t){if(typeof e!="string"){let o=new Uint8Array(await e.arrayBuffer()),r=o.length>0?y(o):void 0;t={method:e.method,headers:Object.fromEntries(e.headers.entries()),base64Body:r},e=e.url}return syscall("sandboxFetch.fetch",e,t)}globalThis.nativeFetch=globalThis.fetch;function A(){globalThis.fetch=async function(e,t){let o=t&&t.body?y(new Uint8Array(await new Response(t.body).arrayBuffer())):void 0,r=await C(e,t&&{method:t.method,headers:t.headers,base64Body:o});return new Response(r.base64Body?w(r.base64Body):null,{status:r.status,headers:r.headers})}}p&&A();typeof self>"u"&&(self={syscall:()=>{throw new Error("Not implemented here")}});function n(e,...t){return globalThis.syscall(e,...t)}var c={};f(c,{getFileMeta:()=>K,listFiles:()=>D,readAsset:()=>q});function j(e){let t=atob(e),o=t.length,r=new Uint8Array(o);for(let i=0;i<o;i++)r[i]=t.charCodeAt(i);return r}function x(e){let t=e.split(",",2)[1];return j(t)}async function q(e,t,o="utf8"){let r=await n("asset.readAsset",e,t);switch(o){case"utf8":return new TextDecoder().decode(x(r));case"dataurl":return r}}async function D(e){return await n("asset.listFiles",e)}async function K(e,t){return await n("asset.getFileMeta",e,t)}var l={};f(l,{parse:()=>B,stringify:()=>V});function B(e){return n("yaml.parse",e)}function V(e){return n("yaml.stringify",e)}function G(e){return e.id===void 0?'missing value "id"':null}async function P(e){let t=await l.parse(e),o=G(t);if(o!=null)return{html:`<p>${o}</p>`};let r=await c.readAsset("leaflet","assets/editor.js");return Promise.resolve({html:`<div id="${t.id}"></div>`,script:r})}var v={leafletWidget:P},h={name:"leaflet",functions:{leafletWidget:{path:"./leaflet.ts:widget",codeWidget:"leaflet"}},assets:{}},Fe={manifest:h,functionMapping:v};g(v,h,self.postMessage);export{Fe as plug};
